[%

PROCESS form_base;

fields_block = 'timerangecollection_control';

BLOCK timerangecollection_control;

  include( 'error_block' );
  include( 'results_block' );
  FOREACH f_name = self.field_names;
    NEXT IF f_name.match('range');
    field = self.fields.$f_name;
    '<p>'; window.render_viewport(field); "</p>\n";
  END;

END;

results_block = 'timerangecollection_results';

BLOCK timerangecollection_results;

  FOREACH field = self.range_vps;
    '<p>'; window.render_viewport(field); "</p>\n";
  END;
  '<input type="hidden"'; connect_control(self, 'max_range_vps'); ' value="'; self.range_vps.size; '" />';
#  INCLUDE component type = 'hidden' self.name = 'max_range_vps' self.val = self.range_vps.size;

END;

error_block = 'timerangecollection_error';

BLOCK timerangecollection_error;

  IF self.warning;
    '<p>'; self.warning; '</p>';
  END;
  IF self.error;
    '<p>'; self.error; '</p>';
  END;

END;

button_block = 'timerangecollection_buttons';

BLOCK timerangecollection_buttons;

  INCLUDE component type = 'submitbtn' self.value = 'add' self.event = 'add_range_vp' self.label = '';

  IF self.has_on_next_callback;
    INCLUDE component type = 'submitbtn' self.value = 'next' self.event = 'next' self.label = '';
  END;

  IF self.is_changed; self.value = 'cancel'; ELSE; self.value = 'close'; END;
  INCLUDE component type = 'cancelbtn' self.label = '' self.event = 'close';
  '<br />';

END;

%]
